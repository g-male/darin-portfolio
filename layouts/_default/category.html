{{ define "main" }}

{{ partial "navigation.html" . }}

<div id="regular-content icons">
  <div class="icon grid">
    {{ $allPosts := .Site.RegularPages }}
    
    {{ range where (where .Site.Pages "Type" "subcategory") "Section" .Section }}
    <div class="grid-item">
      {{ $subsection := . }} <!-- Current subsection -->
      
      <!-- Filter posts to match the current subsection -->
      {{ $contentPosts := where $allPosts "Section" $subsection.Section }}
      {{ $specificPosts := where $contentPosts "Type" "content" }}
      
      <!-- Check if the current post's section matches the subsection title (e.g., "product") -->
      {{ $postCount := len (where $specificPosts "File.Dir" (printf "%s/" $subsection.File.Dir)) }}
      
      <a class="subcategory {{ if .Section }} {{else}} subcatactive {{end}}" href="{{ .Permalink }}">
        <div class="thumbimage-wrapper">
          <img class="thumbimage" src="{{ .Params.thumbimage }}">
          <div class="post-count">{{ $postCount }}</div>
        </div>
        <br> {{ .Title }}
      </a>
      
    </div>
    {{ end }}
  </div>
</div>

{{ end }}
